\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}			      % \chapter package
\usepackage[english]{babel}
\usepackage[english]{isodate}  		  % date format
\usepackage{graphicx}				        % manage images
\usepackage{amsfonts}
\usepackage{booktabs}				        % high quality tables
\usepackage{amsmath}				        % math package
\usepackage{amssymb}				        % another math package (e.g. \nexists)
\usepackage{bm}                     % bold math symbols
\usepackage{mathtools}				      % emphasize equations
\usepackage{stmaryrd} 				      % '\llbracket' and '\rrbracket'
\usepackage{amsthm}					        % better theorems
\usepackage{enumitem}				        % manage list
\usepackage{pifont}					        % nice itemize
\usepackage{cancel}					        % cancel math equations
\usepackage{caption}				        % custom caption
\usepackage[]{mdframed}				      % box text
\usepackage{multirow}				        % more lines in a table
\usepackage{textcomp, gensymb}		  % degree symbol
\usepackage[x11names]{xcolor}		    % RGB color
\usepackage[many]{tcolorbox}		    % colorful box
\usepackage{multicol}				        % more rows in a table (used for the lists)
\usepackage{listings}
\usepackage{url}
\usepackage{qrcode}
\usepackage{fontawesome5}           % https://fontawesome.com/v5/search?ic=free&o=r
\usepackage{ragged2e}
\usepackage{cite}                   % references
\usepackage{imakeidx}               % index
\usepackage{mfirstuc}               % first letter uppercase
\makeindex[program=makeindex, columns=1,
           title=Index, 
           intoc,
           options={-s index-style.ist}]
\usepackage{fancyhdr}
\usepackage{soul}                   % highlight text (as a highlighter)
\usepackage{adjustbox}              % avoid table overfull
\usepackage{tikz}
% \usetikzlibrary{positioning}
\usetikzlibrary{arrows.meta, positioning, calc}

% ~ Dark Mode ~
% \usepackage{pagecolor}      % For background color
% \pagecolor{black}           % Background color
% \color{white}               % Default text color
% \sethlcolor{darkgray}
% \usepackage[colorlinks=true, linkcolor=cyan, urlcolor=cyan]{hyperref} % dark mode

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{0.95,0.95,0.92}
\lstdefinelanguage{misc}
{
  % list of keywords
  morekeywords={%
    add,
    addi,
    lw,
    sw,
    beq,
    bne,
    j,
    jr,
    offset,
    sub,
    and,
    or
  },
  sensitive=false, % keywords are not case-sensitive
  morecomment=[l]{\#}, % l is for line comment
  % morecomment=[s]{/*}{*/}, % s is for start and end delimiter
  % morestring=[b]" % defines that strings are enclosed in double quotes
}
\lstdefinelanguage{unknown}
{
  % list of keywords
  morekeywords={%
    addd,
    addi,
    divd,
    sd,
    muld,
    multd,
    ld,
    subd,
    subi,
    bnez,
    bne
  },
  sensitive=false, % keywords are not case-sensitive
  morecomment=[l]{;}, % l is for line comment
  morecomment=[l]{\#}, % l is for line comment
  % morecomment=[s]{/*}{*/}, % s is for start and end delimiter
  % morestring=[b]" % defines that strings are enclosed in double quotes
}
\lstdefinelanguage{riscv}
{
  % list of keywords
  morekeywords={%
    add,
    addi,
    ld,
    sd,
    offset,
    beq,
    bne,
    j,
    jr,
    nop,
    sub,
    subi,
    and,
    mov
  },
  sensitive=false, % keywords are not case-sensitive
  morecomment=[l]{\#}, % l is for line comment
  % morecomment=[s]{/*}{*/}, % s is for start and end delimiter
  % morestring=[b]" % defines that strings are enclosed in double quotes
}
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},
    commentstyle=\color{codegreen},
    keywordstyle=\color{magenta},
    numberstyle=\tiny\color{codegray},
    stringstyle=\color{codepurple},
    basicstyle=\ttfamily\footnotesize,
    breakatwhitespace=false,
    breaklines=true,
    captionpos=b,
    keepspaces=true,
    numbers=left,
    numbersep=5pt,
    showspaces=false,
    showstringspaces=false,
    showtabs=false,
    tabsize=2
}
\lstset{style=mystyle}


% thanks Mico: https://tex.stackexchange.com/a/60218/312896
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
            {-2.5ex\@plus -1ex \@minus -.25ex}%
            {1.25ex \@plus .25ex}%
            {\normalfont\normalsize\bfseries}}
\makeatother
\setcounter{secnumdepth}{4} % how many sectioning levels to assign numbers to
\setcounter{tocdepth}{4}    % how many sectioning levels to show in ToC


% draw a frame around given text
\newcommand{\framedtext}[1]{%
	\par%
	\noindent\fbox{%
		\parbox{\dimexpr\linewidth-2\fboxsep-2\fboxrule}{#1}%
	}%
}


% table of content links
\usepackage{xcolor}
\usepackage[linkcolor=black, citecolor=blue, urlcolor=cyan]{hyperref} % hypertexnames=false
\hypersetup{
	colorlinks=true
}


\newtheorem{theorem}{\textcolor{Red3}{\underline{Theorem}}}
\renewcommand{\qedsymbol}{QED}
\newcommand{\dquotes}[1]{``#1''}
\newcommand{\important}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\longline}{\noindent\rule{\textwidth}{0.4pt}}
\newcommand{\circledtext}[1]{\raisebox{.5pt}{\textcircled{\raisebox{-.9pt}{#1}}}}
\newcommand{\definition}[1]{\textcolor{Red3}{\textbf{#1}}\index{#1}}
\newcommand{\example}[1]{\textcolor{Green4}{\textbf{#1}}}
\newcommand{\highspace}{\vspace{1.2em}\noindent}
% I never remember every icon, so I use custom commands to do this
\newcommand{\speedIcon}{tachometer-alt}
\newcommand{\definitionWithSpecificIndex}[3]{\textcolor{Red3}{\textbf{#1}}\index{#2}\index{#3}}
\newcommand{\hqlabel}[2]{\label{#1}\hypertarget{#1}{#2}}
\newcommand{\hqpageref}[1]{\hyperlink{#1}{\hypergetpageref{#1}}}
\newcommand{\answer}{\textcolor{Green3}{\textbf{\emph{Answer: }}}}
\newcommand{\version}{v0.12.0}

% \includeonly{
%   sections/advanced-memory/introduction,
%   sections/advanced-memory/principle-of-locality,
%   sections/advanced-memory/so-what-is-a-cache,
%   sections/advanced-memory/cache-performance-metrics,
%   sections/advanced-memory/cache-architecture/cache-architecture,
%   sections/advanced-memory/cache-architecture/block-placement,
%   sections/advanced-memory/cache-architecture/block-identifiation,
%   sections/advanced-memory/cache-architecture/replacement-strategy,
%   sections/advanced-memory/cache-architecture/write-strategy,
%   sections/advanced-memory/miss-penalty-reduction,
%   sections/advanced-memory/design-space-of-cache,
%   %
%   sections/advanced-memory/cache-miss-classification,
%   sections/advanced-memory/improving-cache-performance/improving-cache-performance,
%   sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/increasing-cache-size,
%   sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/increasing-block-size,
%   sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/increasing-associativity,
%   sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/victim-cache,
%   sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/pseudo-associativity-and-way-prediction,
%   sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/hardware-prefetching,
%   sections/bibliography-and-index
% }


\begin{document}
    \newcounter{definition}[section]
    \newcounter{example}[section]
    \newcounter{takeaways}[section]
    
    \newtcolorbox[use counter = definition]{definitionbox}[1][]{%
        breakable,
        enhanced,
        colback=red!5!white,
        colframe=red!75!black,
        fonttitle=\bfseries,
        title={Definition \thetcbcounter #1} %
    }
    
    \newtcolorbox[use counter = example]{examplebox}[1][]{%
        breakable,
        enhanced,
        colback=Green4!5!white,
        colframe=Green4!75!black,
        fonttitle=\bfseries,
        title={Example \thetcbcounter #1} %
    }

    \newtcolorbox[use counter = takeaways]{takeawaysbox}[1][]{%
        breakable,
        enhanced,
        colback=Green3!5!white,
        colframe=Green3!75!black,
        fonttitle=\bfseries,
        title={Key Takeaways#1} %
    }

    \newtcolorbox[]{deepeningbox}[1][]{%
        breakable,
        enhanced,
        colback=DarkOrange3!5!white,
        colframe=DarkOrange3!75!black,
        fonttitle=\bfseries,
        title={Deepening#1} %
    }
	
    %%%%%%%%%%%%%%%
    % Notes cover %
    %%%%%%%%%%%%%%%
    \include{sections/notes-cover}

    %%%%%%%%%%%
    % Preface %
    %%%%%%%%%%%
    \include{sections/preface}

    %%%%%%%%%%%%%%%%%%%%%
    % Table of contents %
    %%%%%%%%%%%%%%%%%%%%%
	  \tableofcontents
    \newpage

    %%%%%%%%%%%%%%%%%%%
    % Fancy pagestyle %
    %%%%%%%%%%%%%%%%%%%
    \pagestyle{fancy}
    \fancyhead{} % clear all header fields
    \fancyhead[R]{\nouppercase{\leftmark\hfill\rightmark}}
    \setlength{\headheight}{22.48724pt}
    \addtolength{\topmargin}{-10.48724pt}

    %%%%%%%%%%%%%%%%%%
    % Basic concepts %
    %%%%%%%%%%%%%%%%%%
    \include{sections/pipelining/basic-concepts}
    \include{sections/pipelining/risc-v-pipelining/risc-v-pipelining}
    \include{sections/pipelining/risc-v-pipelining/instructions-pipelined-execution}
    \include{sections/pipelining/risc-v-pipelining/pipeline-implementation}
    \include{sections/pipelining/problem-of-pipeline-hazards/problem-of-pipeline-hazards}
    \include{sections/pipelining/problem-of-pipeline-hazards/risc-v-optimized-pipeline}
    \include{sections/pipelining/problem-of-pipeline-hazards/solution-to-raw-hazards}
    \include{sections/pipelining/performance-evaluation}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Control Hazards and Branch Prediction %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/control-hazards-and-branch-prediction/conditional-branch-instructions}
    \include{sections/control-hazards-and-branch-prediction/control-hazards}
    \include{sections/control-hazards-and-branch-prediction/naive-solutions-to-control-hazards}
    \include{sections/control-hazards-and-branch-prediction/intro-to-branch-prediction}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/static-branch-prediction}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/branch-always-not-taken}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/branch-always-taken}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/backward-taken-forward-not-taken}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/profile-driven-prediction}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/delayed-branch/delayed-branch}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/delayed-branch/from-before}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/delayed-branch/from-target}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/delayed-branch/from-fall-through}
    \include{sections/control-hazards-and-branch-prediction/static-branch-prediction/delayed-branch/from-after}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/dynamic-branch-prediction}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/1-bit-branch-history-table}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/2-bit-branch-history-table}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/branch-target-buffer}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/correlating-branch-predictors/correlating-branch-predictors}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/correlating-branch-predictors/1-1-correlating-predictors}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/correlating-branch-predictors/2-2-correlating-predictors}
    \include{sections/control-hazards-and-branch-prediction/dynamic-branch-prediction/two-level-adaptive-branch-predictors}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Instruction Level Parallelism %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/instruction-level-parallelism/the-problem-of-dependencies/the-problem-of-dependencies}
    \include{sections/instruction-level-parallelism/the-problem-of-dependencies/data-dependencies}
    \include{sections/instruction-level-parallelism/the-problem-of-dependencies/name-dependencies}
    \include{sections/instruction-level-parallelism/the-problem-of-dependencies/control-dependencies}
    \include{sections/instruction-level-parallelism/multi-cycle-pipelining/multi-cycle-pipelining}
    \include{sections/instruction-level-parallelism/multi-cycle-pipelining/multi-cycle-in-order-pipeline}
    \include{sections/instruction-level-parallelism/multi-cycle-pipelining/multi-cycle-out-of-order-pipeline}
    \include{sections/instruction-level-parallelism/multi-cycle-pipelining/dynamic-scheduling}
    \include{sections/instruction-level-parallelism/multiple-issue-processors/introduction-to-multiple-issue-pipelines}
    \include{sections/instruction-level-parallelism/multiple-issue-processors/evolution-towards-superscalar-execution}
    \include{sections/instruction-level-parallelism/multiple-issue-processors/superscalar-processors}
    \include{sections/instruction-level-parallelism/multiple-issue-processors/static-vs-dynamic-scheduling}
    \include{sections/instruction-level-parallelism/ilp-limitations-and-alternatives}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/assumptions-and-architecture}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/pipeline-stages}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/hazard-management}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/control-logic-and-stages}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/summary}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/scoreboard-data-structures}
    \include{sections/instruction-level-parallelism/scoreboard-dynamic-scheduling-algorithm/in-depth-execution-example}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/introduction}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/register-renaming-static-vs-implicit}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/basic-concepts-of-tomasulo-algorithm}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/architecture}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/stages/stages}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/stages/start-execution}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/stages/write-result}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/in-depth-execution-example}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/tomasulo-vs-scoreboarding}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/register-renaming/introduction}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/register-renaming/loop-unrolling-and-code-scheduling}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/register-renaming/tomasulo-implicit-register-renaming}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/register-renaming/how-tomasulo-overlaps-iterations-of-loops}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/register-renaming/tomasulo-loop-execution}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/reorder-buffer/hardware-based-speculation}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/reorder-buffer/why-rob-is-really-needed}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/reorder-buffer/rob-as-a-data-communication-mechanism}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/reorder-buffer/architecture}
    \include{sections/instruction-level-parallelism/tomasulo-algorithm/reorder-buffer/specualtive-tomasulo-algorithm-with-rob}

    %%%%%%%%%%%%%%%%%%%%%%%%%%
    % Performance Evaluation %
    %%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/performance-evaluation/basic-concepts-and-performance-metrics}
    \include{sections/performance-evaluation/amdahls-law}
    \include{sections/performance-evaluation/pipelined-processors}
    \include{sections/performance-evaluation/memory-hierarchy}
    
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % VLIW (Very Long Instruction Word) %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/vliw/introduction}
    \include{sections/vliw/data-dependences}
    \include{sections/vliw/statically-scheduled-processors}
    \include{sections/vliw/code-scheduling/code-scheduling}
    \include{sections/vliw/code-scheduling/scheduling-basics}
    \include{sections/vliw/code-scheduling/dependence-graph-and-critical-path}
    \include{sections/vliw/code-scheduling/asap-scheduling-algorithm}
    \include{sections/vliw/code-scheduling/list-based-scheduling-algorithm}
    \include{sections/vliw/code-scheduling/local-vs-global-scheduling}
    \include{sections/vliw/code-scheduling/local-scheduling-techniques/loop-unrolling}
    \include{sections/vliw/code-scheduling/local-scheduling-techniques/software-pipelining}
    \include{sections/vliw/code-scheduling/global-scheduling-techniques/trace-scheduling}
    \include{sections/vliw/code-scheduling/global-scheduling-techniques/superblock-scheduling}

    %%%%%%%%%%%%%%%%%%%
    % Advanced Memory %
    %%%%%%%%%%%%%%%%%%%
    \include{sections/advanced-memory/introduction}
    \include{sections/advanced-memory/principle-of-locality}
    \include{sections/advanced-memory/so-what-is-a-cache}
    \include{sections/advanced-memory/cache-performance-metrics}
    \include{sections/advanced-memory/cache-architecture/cache-architecture}
    \include{sections/advanced-memory/cache-architecture/block-placement}
    \include{sections/advanced-memory/cache-architecture/block-identifiation}
    \include{sections/advanced-memory/cache-architecture/replacement-strategy}
    \include{sections/advanced-memory/cache-architecture/write-strategy}
    \include{sections/advanced-memory/miss-penalty-reduction}
    \include{sections/advanced-memory/design-space-of-cache}
    \include{sections/advanced-memory/cache-miss-classification}
    \include{sections/advanced-memory/improving-cache-performance/improving-cache-performance}
    \include{sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/increasing-cache-size}
    \include{sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/increasing-block-size}
    \include{sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/increasing-associativity}
    \include{sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/victim-cache}
    \include{sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/pseudo-associativity-and-way-prediction}
    \include{sections/advanced-memory/improving-cache-performance/reducing-miss-rate-techniques/hardware-prefetching}

    %%%%%%%%%
    % Exams %
    %%%%%%%%%
    \include{sections/exams/2025/may-5}
    \include{sections/exams/2025/february-11}

    %%%%%%%%%%%%%%%%%%%%%%%%%
    % Clear fancy pagestyle %
    %%%%%%%%%%%%%%%%%%%%%%%%%
    \pagestyle{fancy}
    \fancyhead{} % clear all header fields
    \fancyhead[R]{\nouppercase{\leftmark}}

    %%%%%%%%%%%%%%%%%%%%%%%%%%
    % Bibliography and index %
    %%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/bibliography-and-index}
\end{document}