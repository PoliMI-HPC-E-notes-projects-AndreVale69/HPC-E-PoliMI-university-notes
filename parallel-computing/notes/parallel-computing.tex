\documentclass[a4paper]{article}
\usepackage[T1]{fontenc}			% \chapter package
\usepackage[english]{babel}
\usepackage[english]{isodate}  		% date format
\usepackage{graphicx}				% manage images
\usepackage{subcaption}             % manage subfigures
\usepackage{amsfonts}
\usepackage{booktabs}				% high quality tables
\usepackage{amsmath}				% math package
\usepackage{amssymb}				% another math package (e.g. \nexists)
\usepackage{bm}                     % bold math symbols
\usepackage{mathtools}				% emphasize equations
\usepackage{amsthm}					% better theorems
\usepackage{enumitem}				% manage list
\usepackage{pifont}					% nice itemize
\usepackage{cancel}					% cancel math equations
\usepackage{caption}				% custom caption
\usepackage[]{mdframed}				% box text
\usepackage{multirow}				% more lines in a table
\usepackage[x11names]{xcolor}		% RGB color
\usepackage[many]{tcolorbox}		% colorful box
\usepackage{listings}               % use to writing code
\usepackage{qrcode}                 % use for qr-codes
\usepackage{fontawesome5}           % use for icons
\usepackage{ragged2e}               % use for \flushleft command
\usepackage{cite}                   % references
\usepackage{imakeidx}               % index
\usepackage{fancyhdr}               % extensive facilities, both for constructing headers and footers 
\usepackage{wrapfig}                % allows figures or tables to have text wrapped around them
\makeindex[program=makeindex, columns=1,
           title=Index, 
           intoc,
           options={-s index-style.ist}]
\usepackage{multicol}               % multi-column itemize
\usepackage{soul}                   % highlight text (as a highlighter)
\usepackage{tikz}
\usetikzlibrary{arrows.meta, positioning}

%\pdfcompresslevel=0
%\pdfobjcompresslevel=0

\definecolor{codegreen}{rgb}{0,0.6,0}
\definecolor{codegray}{rgb}{0.5,0.5,0.5}
\definecolor{codepurple}{rgb}{0.58,0,0.82}
\definecolor{backcolour}{rgb}{255,255,255}
\lstdefinestyle{mystyle}{
    backgroundcolor=\color{backcolour},   
	commentstyle=\color{codegreen},
	keywordstyle=\color{magenta},
	numberstyle=\tiny\color{codegray},
	stringstyle=\color{codepurple},
	basicstyle=\ttfamily\footnotesize,
	breakatwhitespace=false,         
	breaklines=true,                 
	captionpos=b,                    
	keepspaces=true,                 
	numbers=left,                    
	numbersep=5pt,                  
	showspaces=false,                
	showstringspaces=false,
	showtabs=false,                  
	tabsize=2,
    mathescape,
    frame=lines
}

\lstdefinelanguage{JavaScript}{
	keywords={typeof, new, true, false, catch, function, return, null, catch, switch, var, if, in, while, do, else, case, break, reduce, map},
	keywordstyle=\color{blue}\bfseries,
	ndkeywords={class, export, boolean, throw, implements, import, this, const},
	ndkeywordstyle=\color{darkgray}\bfseries,
	identifierstyle=\color{black},
	sensitive=false,
	comment=[l]{//},
	morecomment=[s]{/*}{*/},
	commentstyle=\color{codegreen}\ttfamily,
	stringstyle=\color{red}\ttfamily,
	morestring=[b]',
	morestring=[b]"
}

\lstset{
	language=JavaScript,
	backgroundcolor=\color{lightgray},
	extendedchars=true,
	basicstyle=\footnotesize\ttfamily,
	showstringspaces=false,
	showspaces=false,
	numbers=left,
	numberstyle=\footnotesize,
	numbersep=9pt,
	tabsize=2,
	breaklines=true,
	showtabs=false,
	captionpos=b
}

\lstset{style=mystyle}


% thanks Mico: https://tex.stackexchange.com/a/60218/312896
\makeatletter
\renewcommand\paragraph{\@startsection{paragraph}{4}{\z@}%
            {-2.5ex\@plus -1ex \@minus -.25ex}%
            {1.25ex \@plus .25ex}%
            {\normalfont\normalsize\bfseries}}
\makeatother
\setcounter{secnumdepth}{4} % how many sectioning levels to assign numbers to
\setcounter{tocdepth}{4}    % how many sectioning levels to show in ToC


% draw a frame around given text
\newcommand{\framedtext}[1]{%
	\par%
	\noindent\fbox{%
		\parbox{\dimexpr\linewidth-2\fboxsep-2\fboxrule}{#1}%
	}%
}


% table of content links
\usepackage{xcolor}
\usepackage[linkcolor=black, citecolor=blue, urlcolor=cyan]{hyperref} % hypertexnames=false
\hypersetup{
	colorlinks=true
}


\newtheorem{theorem}{\textcolor{Red3}{\underline{Theorem}}}
\newtheorem{lemma}[theorem]{\textcolor{Red3}{\underline{Lemma}}}
\renewcommand{\qedsymbol}{QED}
\newcommand{\dquotes}[1]{``#1''}
\newcommand{\longline}{\noindent\rule{\textwidth}{0.4pt}}
\newcommand{\circledtext}[1]{\raisebox{.5pt}{\textcircled{\raisebox{-.9pt}{#1}}}}
\newcommand{\important}[1]{\textcolor{red}{\textbf{#1}}}
\newcommand{\definition}[1]{\textcolor{Red3}{\textbf{#1}}\index{#1}}
\newcommand{\blackdefinition}[1]{\textbf{#1}\index{#1}}
\newcommand{\definitionWithSpecificIndex}[3]{\textcolor{Red3}{\textbf{#1}}\index{#2}\index{#3}}
\newcommand{\example}[1]{\textcolor{Green4}{\textbf{#1}}}
\newcommand{\highspace}{\vspace{1.2em}\noindent}
\renewcommand{\lstlistingname}{Algorithm}
\renewcommand{\lstlistlistingname}{Algorithms}
\newcommand{\hqlabel}[2]{\label{#1}\hypertarget{#1}{#2}}
\newcommand{\hqpageref}[1]{\hyperlink{#1}{\hypergetpageref{#1}}}
\newcommand{\version}{v1.0.0-dev}
% fontawesome5 macro:
% I never remember every icon, so I use custom commands to do this
\newcommand{\speedIcon}{tachometer-alt}

% development:
\includeonly{
    sections/heterogeneous-computing-dsls-and-hls/introduction-to-heterogeneous-computing,
    sections/heterogeneous-computing-dsls-and-hls/heterogeneous-parallel-programming,
    sections/heterogeneous-computing-dsls-and-hls/dsls-and-halide,
    sections/heterogeneous-computing-dsls-and-hls/scheduling-and-performance-optimization-in-halide,
    sections/heterogeneous-computing-dsls-and-hls/introduction-to-hls,
    sections/heterogeneous-computing-dsls-and-hls/hls-workflow
}

\begin{document}
    \newcounter{definition}[section]
    \newcounter{example}[section]
    \newcounter{exercise}[section]
    
    \newtcolorbox[use counter = definition]{definitionbox}[1][]{%
        breakable,
        enhanced,
        colback=red!5!white,
        colframe=red!75!black,
        fonttitle=\bfseries,
        title={Definition \thetcbcounter#1} %
    }

    \newtcolorbox[]{pthreadbox}[1][]{%
        breakable,
        enhanced,
        colback=Red3!5!white,
        colframe=Red3!75!black,
        fonttitle=\bfseries,
        title={pthread API#1} %
    }

    \newtcolorbox[]{openmpbox}[1][]{%
        breakable,
        enhanced,
        colback=Red3!5!white,
        colframe=Red3!75!black,
        fonttitle=\bfseries,
        title={OpenMP#1} %
    }

    \newtcolorbox[use counter = exercise]{exercisebox}[1][]{%
        breakable,
        enhanced,
        colback=Red3!5!white,
        colframe=Red3!75!black,
        fonttitle=\bfseries,
        title={Exercise \thetcbcounter#1} %
    }
    
    \newtcolorbox[use counter = example]{examplebox}[1][]{%
        breakable,
        enhanced,
        colback=Green4!5!white,
        colframe=Green4!75!black,
        fonttitle=\bfseries,
        title={Example \thetcbcounter#1} %
    }

    \newtcolorbox[]{remarkbox}[1][]{%
        breakable,
        enhanced,
        colback=DarkOrange3!5!white,
        colframe=DarkOrange3!75!black,
        fonttitle=\bfseries,
        title={Remark#1} %
    }

    %%%%%%%%%%%%%%%
    % Notes cover %
    %%%%%%%%%%%%%%%
    \include{sections/notes-cover}

    %%%%%%%%%%%-dev
	\include{sections/preface}

    %%%%%%%%%%%%%%%%%%%%%
    % Table of contents %
    %%%%%%%%%%%%%%%%%%%%%
    \tableofcontents
    \newpage

    %%%%%%%%%%%%%%%%%%%
    % Fancy pagestyle %
    %%%%%%%%%%%%%%%%%%%
    \pagestyle{fancy}
    \fancyhead{} % clear all header fields
    \fancyhead[R]{\nouppercase{\leftmark\hfill\rightmark}}

    %%%%%%%%
    % PRAM %
    %%%%%%%%
    \include{sections/pram/prerequisites} % and definition
    \include{sections/pram/how-it-works}
    \include{sections/pram/mvm-algorithm}
    \include{sections/pram/spmd-sum}
    \include{sections/pram/mm-algorithm}
    \include{sections/pram/pram-variants-and-lemmas}
    \include{sections/pram/pram-implementation}
    \include{sections/pram/amdahl-and-gustafson-laws}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Fundamentals of architecture %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/fundamentals-of-architecture/fundamentals-of-architecture}
    \include{sections/fundamentals-of-architecture/accessing-memory}

    %%%%%%%%%%%%%%%%%%%%%%
    % Programming models %
    %%%%%%%%%%%%%%%%%%%%%%
    \include{sections/programming-models/ispc}
    \include{sections/programming-models/shared-address-space-model}
    \include{sections/programming-models/message-passing-model-of-communication}
    \include{sections/programming-models/data-parallel-model}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Parallel Programming Models and POSIX Threads %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/parallel-programming-models-and-pthreads/how-to-create-parallel-algorithms-and-programs}
    \include{sections/parallel-programming-models-and-pthreads/analyze-parallel-algorithms}
    \include{sections/parallel-programming-models-and-pthreads/technologies}
    \include{sections/parallel-programming-models-and-pthreads/threads}

    %%%%%%%%%%
    % OpenMP %
    %%%%%%%%%%
    \include{sections/openmp/introduction}
    \include{sections/openmp/basic-syntax}
    \include{sections/openmp/work-sharing/for}
    \include{sections/openmp/work-sharing/sections}
    \include{sections/openmp/work-sharing/single-master}
    \include{sections/openmp/work-sharing/tasks/tasks}
    \include{sections/openmp/work-sharing/tasks/task-dependences}
    \include{sections/openmp/synchronization}
    \include{sections/openmp/data-environment}
    \include{sections/openmp/memory-model}
    \include{sections/openmp/nested-parallelism}
    \include{sections/openmp/cancellation}
    \include{sections/openmp/simd-vectorization}

    %%%%%%%%%%%%%%%%%%%%
    % GPU Architecture %
    %%%%%%%%%%%%%%%%%%%%
    \include{sections/gpu-architecture/introduction}
    \include{sections/gpu-architecture/gpu-compute-mode}
    \include{sections/gpu-architecture/cuda/basics-of-cuda}
    \include{sections/gpu-architecture/cuda/memory-model}
    \include{sections/gpu-architecture/cuda/nvidia-v100-sm}
    \include{sections/gpu-architecture/cuda/running-a-cuda-program-on-a-gpu}
    \include{sections/gpu-architecture/cuda/implementation-of-cuda-abstractions}
    \include{sections/gpu-architecture/cuda/advanced-thread-scheduling}
    \include{sections/gpu-architecture/cuda/memory-and-data-locality-in-depth}
    \include{sections/gpu-architecture/cuda/tiling-technique/tiling-technique}
    \include{sections/gpu-architecture/cuda/tiling-technique/tiled-matrix-multiplication}
    \include{sections/gpu-architecture/cuda/tiling-technique/implementation-tiled-matrix-multiplication}
    \include{sections/gpu-architecture/cuda/tiling-technique/any-size-matrix-handling}
    \include{sections/gpu-architecture/cuda/optimizing-memory-coalescing}

    %%%%%%%%
    % CUDA %
    %%%%%%%%
    \include{sections/cuda/introduction}
    \include{sections/cuda/cuda-basis/cuda-basis}
    \include{sections/cuda/cuda-basis/gpgpu-best-practice}
    \include{sections/cuda/cuda-basis/compilation}
    \include{sections/cuda/cuda-basis/debugging}
    \include{sections/cuda/cuda-basis/kernel-function}
    \include{sections/cuda/execution-model}
    \include{sections/cuda/querying-device-properties}
    \include{sections/cuda/thread-hierarchy}
    \include{sections/cuda/memory-hierarchy}
    \include{sections/cuda/streams}
    \include{sections/cuda/cuda-and-openmp-or-mpi/motivations}
    \include{sections/cuda/cuda-and-openmp-or-mpi/cuda-api-for-multi-gpus}
    \include{sections/cuda/cuda-and-openmp-or-mpi/memory-management-with-multiple-gpus}
    \include{sections/cuda/cuda-and-openmp-or-mpi/batch-processing-and-cooperative-patterns-with-openmp}
    \include{sections/cuda/cuda-and-openmp-or-mpi/openmp-for-heterogeneous-architectures}
    \include{sections/cuda/cuda-and-openmp-or-mpi/mpi-cuda-applications}

    %%%%%%%%%%%%%%%
    % Consistency %
    %%%%%%%%%%%%%%%
    \include{sections/memory-consistency/coherence-vs-consistency}
    \include{sections/memory-consistency/definition}
    \include{sections/memory-consistency/sequential-consistency-model}
    \include{sections/memory-consistency/memory-models-with-relaxed-ordering}
    \include{sections/memory-consistency/languages-need-memory-models-too}
    \include{sections/memory-consistency/implementing-locks/introduction}
    \include{sections/memory-consistency/implementing-locks/test-and-set-based-lock}
    \include{sections/memory-consistency/implementing-locks/test-and-set-and-set-lock}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Heterogeneous Processing %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/heterogeneous-processing/heterogeneous-processing}
    \include{sections/heterogeneous-processing/energy-constrained-computing}
    \include{sections/heterogeneous-processing/compute-specialization}
    \include{sections/heterogeneous-processing/challenges-of-heterogeneous-designs}
    \include{sections/heterogeneous-processing/reducing-energy-consumption}

    %%%%%%%%%%%%
    % Patterns %
    %%%%%%%%%%%%
    \include{sections/patterns/dependencies}
    \include{sections/patterns/parallel-patterns/parallel-patterns}
    \include{sections/patterns/parallel-patterns/nesting-pattern}
    \include{sections/patterns/parallel-patterns/serial-control-patterns}
    \include{sections/patterns/parallel-patterns/parallel-control-patterns}
    \include{sections/patterns/parallel-patterns/serial-data-management-patterns}
    \include{sections/patterns/parallel-patterns/parallel-data-management-patterns}
    \include{sections/patterns/parallel-patterns/other-parallel-patterns}
    \include{sections/patterns/map-pattern/what-is-a-map}
    \include{sections/patterns/map-pattern/optimizations/sequences-of-maps}
    \include{sections/patterns/map-pattern/optimizations/code-fusion}
    \include{sections/patterns/map-pattern/optimizations/cache-fusion}
    \include{sections/patterns/map-pattern/related-patterns}
    \include{sections/patterns/map-pattern/scaled-vector-addition-saxpy}
    \include{sections/patterns/collectives/collectives}
    \include{sections/patterns/collectives/reduce-pattern}
    \include{sections/patterns/collectives/scan-pattern}
    \include{sections/patterns/gather-pattern/what-is-a-gather}
    \include{sections/patterns/gather-pattern/shift}
    \include{sections/patterns/gather-pattern/zip}
    \include{sections/patterns/gather-pattern/unzip}
    \include{sections/patterns/scatter-pattern/what-is-a-scatter}
    \include{sections/patterns/scatter-pattern/avoid-race-conditions/atomic-scatter}
    \include{sections/patterns/scatter-pattern/avoid-race-conditions/permutation-scatter}
    \include{sections/patterns/scatter-pattern/avoid-race-conditions/merge-scatter}
    \include{sections/patterns/scatter-pattern/avoid-race-conditions/priority-scatter}
    \include{sections/patterns/pack-pattern/what-is-a-pack}
    \include{sections/patterns/pack-pattern/split}
    \include{sections/patterns/pack-pattern/unsplit}
    \include{sections/patterns/pack-pattern/bin}
    \include{sections/patterns/pack-pattern/expand}
    \include{sections/patterns/partitioning-data}
    \include{sections/patterns/aos-vs-soa}
    \include{sections/patterns/stencil-pattern/what-is-a-stencil}
    \include{sections/patterns/stencil-pattern/implementing-stencil-with-shift}
    \include{sections/patterns/stencil-pattern/cache-optimizations}
    \include{sections/patterns/stencil-pattern/communication-optimizations}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Parallel patterns in OpenMP and CUDA %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/parallel-patterns-in-openmp-and-cuda/openmp}
    \include{sections/parallel-patterns-in-openmp-and-cuda/histogram-pattern}
    \include{sections/parallel-patterns-in-openmp-and-cuda/reduction-pattern}
    \include{sections/parallel-patterns-in-openmp-and-cuda/scan-pattern}

    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    % Heterogeneous Computing - DSLs and HLS %
    %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/heterogeneous-computing-dsls-and-hls/introduction-to-heterogeneous-computing}
    \include{sections/heterogeneous-computing-dsls-and-hls/heterogeneous-parallel-programming}
    \include{sections/heterogeneous-computing-dsls-and-hls/dsls-and-halide}
    \include{sections/heterogeneous-computing-dsls-and-hls/scheduling-and-performance-optimization-in-halide}
    \include{sections/heterogeneous-computing-dsls-and-hls/introduction-to-hls}
    \include{sections/heterogeneous-computing-dsls-and-hls/hls-workflow}

    % TODO:
    % 3. Patterns:
    % 3.1 A (done)
    % 3.2 B (done)
    % 3.3 C (done)
    % 3.4 Stencil (from page 56) (done)
    % 4. Parallel patterns in OpenMP and CUDA (done)
    % 5. DSL - HLS
    %   - "Traditional" FPGA/ASIC design flow
    %   - High-Level Synthesis (HLS) p. 41-47
    %   - The FSMD model p. 48
    %   - Manual example p. 49-51
    %   - HLS IR basic concepts p. 52-54
    %   - HLS scheduling p. 55-72

    %%%%%%%%%%%%%%%%%%%%%%%%%%
    % Bibliography and index %
    %%%%%%%%%%%%%%%%%%%%%%%%%%
    \include{sections/bibliography-and-index}
\end{document}